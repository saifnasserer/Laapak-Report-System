Executing (default): SELECT 1+1 AS result
âœ… Database connected successfully.
Found 13 migration files
Running migration: 001_create_admins_table.sql
Executing (default): -- Migration: Create Admins Table

CREATE TABLE IF NOT EXISTS admins (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  role ENUM('admin', 'technician', 'viewer') NOT NULL DEFAULT 'viewer',
  email VARCHAR(255),
  lastLogin DATETIME,
  createdAt DATETIME NOT NULL,
  updatedAt DATETIME NOT NULL
);
Migration 001_create_admins_table.sql completed successfully
Running migration: 002_create_clients_table.sql
Executing (default): -- Migration: Create Clients Table

CREATE TABLE IF NOT EXISTS clients (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  phone VARCHAR(255) NOT NULL UNIQUE,
  orderCode VARCHAR(255) NOT NULL,
  email VARCHAR(255),
  address TEXT,
  status ENUM('active', 'inactive') NOT NULL DEFAULT 'active',
  lastLogin DATETIME,
  createdAt DATETIME NOT NULL,
  updatedAt DATETIME NOT NULL
);
Migration 002_create_clients_table.sql completed successfully
Running migration: 003_create_reports_table.sql
Executing (default): -- Migration: Create Reports Table

CREATE TABLE IF NOT EXISTS reports (
  id VARCHAR(50) PRIMARY KEY,
  client_id INT NOT NULL,
  client_name VARCHAR(100),
  client_phone VARCHAR(20),
  client_email VARCHAR(100),
  client_address TEXT,
  order_number VARCHAR(20) NOT NULL,
  device_model VARCHAR(100) NOT NULL,
  serial_number VARCHAR(100),
  inspection_date DATETIME NOT NULL,
  hardware_status LONGTEXT,
  external_images LONGTEXT,
  notes TEXT,
  billing_enabled TINYINT(1) DEFAULT 0,
  amount DECIMAL(10,2) DEFAULT 0.00,
  status ENUM('pending', 'in-progress', 'completed', 'cancelled', 'active') DEFAULT 'active',
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL,
  FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE CASCADE
);
Migration 003_create_reports_table.sql completed successfully
Running migration: 004_create_invoices_table.sql
Executing (default): -- Migration: Create Invoices Table

CREATE TABLE IF NOT EXISTS invoices (
  id VARCHAR(255) PRIMARY KEY,
  reportId VARCHAR(255),
  clientId INT NOT NULL,
  date DATETIME NOT NULL,
  subtotal DECIMAL(10,2) NOT NULL,
  discount DECIMAL(10,2) DEFAULT 0.00,
  taxRate DECIMAL(5,2) DEFAULT 14.00,
  tax DECIMAL(10,2) NOT NULL,
  total DECIMAL(10,2) NOT NULL,
  paymentStatus ENUM('unpaid', 'partial', 'paid') DEFAULT 'unpaid',
  paymentMethod VARCHAR(255),
  paymentDate DATETIME,
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL,
  FOREIGN KEY (reportId) REFERENCES reports(id) ON DELETE SET NULL,
  FOREIGN KEY (clientId) REFERENCES clients(id) ON DELETE CASCADE
);
Migration 004_create_invoices_table.sql completed successfully
Running migration: 005_create_invoice_items_table.sql
Executing (default): -- Migration: Create Invoice Items Table

CREATE TABLE IF NOT EXISTS invoice_items (
  id INT AUTO_INCREMENT PRIMARY KEY,
  invoiceId VARCHAR(255) NOT NULL,
  description VARCHAR(255) NOT NULL,
  type ENUM('laptop', 'item', 'service') NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  quantity INT DEFAULT 1,
  totalAmount DECIMAL(10,2) NOT NULL,
  serialNumber VARCHAR(255),
  created_at DATETIME NOT NULL,
  FOREIGN KEY (invoiceId) REFERENCES invoices(id) ON DELETE CASCADE
);
Migration 005_create_invoice_items_table.sql completed successfully
Running migration: 006_create_goals_table.sql
Executing (default): -- Create goals table
CREATE TABLE IF NOT EXISTS goals (
    id INT AUTO_INCREMENT PRIMARY KEY,
    month VARCHAR(20) NOT NULL,
    year INT NOT NULL,
    type ENUM('reports', 'clients', 'revenue', 'custom') NOT NULL DEFAULT 'reports',
    title VARCHAR(255) NOT NULL,
    target INT NOT NULL,
    current INT NOT NULL DEFAULT 0,
    unit VARCHAR(50) NOT NULL DEFAULT 'ØªÙ‚Ø±ÙŠØ±',
    isActive BOOLEAN NOT NULL DEFAULT TRUE,
    createdBy INT NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_month_year (month, year),
    INDEX idx_type (type),
    INDEX idx_isActive (isActive)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
Migration 006_create_goals_table.sql completed successfully
Running migration: 007_create_achievements_table.sql
Executing (default): -- Create achievements table
CREATE TABLE IF NOT EXISTS achievements (
    id INT AUTO_INCREMENT PRIMARY KEY,
    type ENUM('milestone', 'record', 'streak', 'custom') NOT NULL DEFAULT 'milestone',
    title VARCHAR(255) NOT NULL,
    description TEXT,
    metric VARCHAR(100) NOT NULL,
    value INT NOT NULL,
    icon VARCHAR(100) DEFAULT 'fas fa-trophy',
    color VARCHAR(20) DEFAULT '#007553',
    isActive BOOLEAN NOT NULL DEFAULT TRUE,
    achievedAt TIMESTAMP NULL,
    createdBy INT NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_type (type),
    INDEX idx_isActive (isActive),
    INDEX idx_achievedAt (achievedAt)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
Migration 007_create_achievements_table.sql completed successfully
Running migration: 008_create_financial_tables.sql
Executing (default): -- Migration: Create Financial Management Tables
-- This migration adds tables for tracking product costs, expenses, and financial analytics

-- Create expense categories table
CREATE TABLE IF NOT EXISTS expense_categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    name_ar VARCHAR(100) NOT NULL,
    description TEXT,
    color VARCHAR(7) DEFAULT '#007553',
    budget_limit DECIMAL(10,2) DEFAULT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Create expenses table
CREATE TABLE IF NOT EXISTS expenses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    name_ar VARCHAR(255) NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    category_id INT NOT NULL,
    type ENUM('fixed', 'variable') NOT NULL DEFAULT 'variable',
    date DATE NOT NULL,
    repeat_monthly BOOLEAN DEFAULT FALSE,
    description TEXT,
    receipt_url VARCHAR(500),
    status ENUM('pending', 'approved', 'paid', 'cancelled') DEFAULT 'approved',
    created_by INT NOT NULL,
    approved_by INT DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE RESTRICT,
    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,
    FOREIGN KEY (approved_by) REFERENCES admins(id) ON DELETE SET NULL,
    INDEX idx_date (date),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_category (category_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Create product costs table (to track cost prices)
CREATE TABLE IF NOT EXISTS product_costs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(255) NOT NULL,
    product_model VARCHAR(255) NOT NULL,
    serial_number VARCHAR(255),
    cost_price DECIMAL(10,2) NOT NULL,
    supplier VARCHAR(255),
    purchase_date DATE,
    effective_date DATE NOT NULL,
    notes TEXT,
    created_by INT NOT NULL,
    updated_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,
    FOREIGN KEY (updated_by) REFERENCES admins(id) ON DELETE SET NULL,
    INDEX idx_product_name (product_name),
    INDEX idx_product_model (product_model),
    INDEX idx_serial_number (serial_number),
    INDEX idx_effective_date (effective_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Create monthly financial summaries table (for faster dashboard queries)
CREATE TABLE IF NOT EXISTS financial_summaries (
    id INT AUTO_INCREMENT PRIMARY KEY,
    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01
    total_revenue DECIMAL(12,2) DEFAULT 0.00,
    total_cost DECIMAL(12,2) DEFAULT 0.00,
    total_expenses DECIMAL(12,2) DEFAULT 0.00,
    gross_profit DECIMAL(12,2) DEFAULT 0.00,
    net_profit DECIMAL(12,2) DEFAULT 0.00,
    profit_margin DECIMAL(5,2) DEFAULT 0.00,
    invoice_count INT DEFAULT 0,
    expense_count INT DEFAULT 0,
    last_calculated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_month_year (month_year),
    INDEX idx_month_year (month_year)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Create budget allocations table
CREATE TABLE IF NOT EXISTS budget_allocations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    category_id INT NOT NULL,
    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01
    allocated_amount DECIMAL(10,2) NOT NULL,
    spent_amount DECIMAL(10,2) DEFAULT 0.00,
    remaining_amount DECIMAL(10,2) GENERATED ALWAYS AS (allocated_amount - spent_amount) STORED,
    notes TEXT,
    created_by INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,
    UNIQUE KEY unique_category_month (category_id, month_year),
    INDEX idx_month_year (month_year)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Insert default expense categories
INSERT INTO expense_categories (name, name_ar, description, color) VALUES
('Office Rent', 'Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨', 'Monthly office rental payments', '#e74c3c'),
('Marketing', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Advertising and promotional expenses', '#3498db'),
('Equipment', 'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', 'Computer equipment and tools', '#9b59b6'),
('Utilities', 'Ø§Ù„Ù…Ø±Ø§ÙÙ‚', 'Electricity, internet, phone bills', '#f39c12'),
('Transportation', 'Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª', 'Travel and delivery expenses', '#1abc9c'),
('Office Supplies', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨', 'Stationery and office materials', '#34495e'),
('Professional Services', 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', 'Legal, accounting, consulting fees', '#e67e22'),
('Maintenance', 'Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Equipment maintenance and repairs', '#95a5a6'),
('Insurance', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Business insurance premiums', '#2c3e50'),
('Miscellaneous', 'Ù…ØªÙ†ÙˆØ¹Ø©', 'Other business expenses', '#7f8c8d');
DELIMITER ;

-- Add foreign key to link invoice items with product costs (optional enhancement)
ALTER TABLE invoice_items ADD COLUMN product_cost_id INT DEFAULT NULL;
ALTER TABLE invoice_items ADD FOREIGN KEY (product_cost_id) REFERENCES product_costs(id) ON DELETE SET NULL;

-- Add calculated profit fields to invoice_items table
ALTER TABLE invoice_items ADD COLUMN cost_price DECIMAL(10,2) DEFAULT NULL;
ALTER TABLE invoice_items ADD COLUMN profit_amount DECIMAL(10,2) GENERATED ALWAYS AS (
    CASE 
        WHEN cost_price IS NOT NULL THEN (amount - cost_price) * quantity
        ELSE NULL 
    END
) STORED;
ALTER TABLE invoice_items ADD COLUMN profit_margin DECIMAL(5,2) GENERATED ALWAYS AS (
    CASE 
        WHEN cost_price IS NOT NULL AND amount > 0 THEN ((amount - cost_price) / amount) * 100
        ELSE NULL 
    END
) STORED;
Error running migrations: Error
    at Query.run (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/sequelize/lib/dialects/mysql/query.js:52:25)
    at /media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/sequelize/lib/sequelize.js:315:28
    at async runMigrations (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/backend/config/dbInit.js:46:13)
    at async initDatabase (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/backend/config/dbInit.js:61:34)
    at async startServer (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/backend/server.js:133:31) {
  name: 'SequelizeDatabaseError',
  parent: Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'CREATE TABLE IF NOT EXISTS expenses (
      id INT AUTO_INCREMENT PRIMARY KEY,
     ' at line 17
      at Packet.asError (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/commands/command.js:29:26)
      at Connection.handlePacket (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:475:34)
      at PacketParser.onPacket (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_PARSE_ERROR',
    errno: 1064,
    sqlState: '42000',
    sqlMessage: "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'CREATE TABLE IF NOT EXISTS expenses (\n" +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      "   ' at line 17",
    sql: '-- Migration: Create Financial Management Tables\n' +
      '-- This migration adds tables for tracking product costs, expenses, and financial analytics\n' +
      '\n' +
      '-- Create expense categories table\n' +
      'CREATE TABLE IF NOT EXISTS expense_categories (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    name VARCHAR(100) NOT NULL,\n' +
      '    name_ar VARCHAR(100) NOT NULL,\n' +
      '    description TEXT,\n' +
      "    color VARCHAR(7) DEFAULT '#007553',\n" +
      '    budget_limit DECIMAL(10,2) DEFAULT NULL,\n' +
      '    is_active BOOLEAN DEFAULT TRUE,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create expenses table\n' +
      'CREATE TABLE IF NOT EXISTS expenses (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    name VARCHAR(255) NOT NULL,\n' +
      '    name_ar VARCHAR(255) NOT NULL,\n' +
      '    amount DECIMAL(10,2) NOT NULL,\n' +
      '    category_id INT NOT NULL,\n' +
      "    type ENUM('fixed', 'variable') NOT NULL DEFAULT 'variable',\n" +
      '    date DATE NOT NULL,\n' +
      '    repeat_monthly BOOLEAN DEFAULT FALSE,\n' +
      '    description TEXT,\n' +
      '    receipt_url VARCHAR(500),\n' +
      "    status ENUM('pending', 'approved', 'paid', 'cancelled') DEFAULT 'approved',\n" +
      '    created_by INT NOT NULL,\n' +
      '    approved_by INT DEFAULT NULL,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE RESTRICT,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (approved_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
      '    INDEX idx_date (date),\n' +
      '    INDEX idx_type (type),\n' +
      '    INDEX idx_status (status),\n' +
      '    INDEX idx_category (category_id)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create product costs table (to track cost prices)\n' +
      'CREATE TABLE IF NOT EXISTS product_costs (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    product_name VARCHAR(255) NOT NULL,\n' +
      '    product_model VARCHAR(255) NOT NULL,\n' +
      '    serial_number VARCHAR(255),\n' +
      '    cost_price DECIMAL(10,2) NOT NULL,\n' +
      '    supplier VARCHAR(255),\n' +
      '    purchase_date DATE,\n' +
      '    effective_date DATE NOT NULL,\n' +
      '    notes TEXT,\n' +
      '    created_by INT NOT NULL,\n' +
      '    updated_by INT,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (updated_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
      '    INDEX idx_product_name (product_name),\n' +
      '    INDEX idx_product_model (product_model),\n' +
      '    INDEX idx_serial_number (serial_number),\n' +
      '    INDEX idx_effective_date (effective_date)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create monthly financial summaries table (for faster dashboard queries)\n' +
      'CREATE TABLE IF NOT EXISTS financial_summaries (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
      '    total_revenue DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    total_cost DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    total_expenses DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    gross_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    net_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    profit_margin DECIMAL(5,2) DEFAULT 0.00,\n' +
      '    invoice_count INT DEFAULT 0,\n' +
      '    expense_count INT DEFAULT 0,\n' +
      '    last_calculated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    UNIQUE KEY unique_month_year (month_year),\n' +
      '    INDEX idx_month_year (month_year)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create budget allocations table\n' +
      'CREATE TABLE IF NOT EXISTS budget_allocations (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    category_id INT NOT NULL,\n' +
      '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
      '    allocated_amount DECIMAL(10,2) NOT NULL,\n' +
      '    spent_amount DECIMAL(10,2) DEFAULT 0.00,\n' +
      '    remaining_amount DECIMAL(10,2) GENERATED ALWAYS AS (allocated_amount - spent_amount) STORED,\n' +
      '    notes TEXT,\n' +
      '    created_by INT NOT NULL,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    UNIQUE KEY unique_category_month (category_id, month_year),\n' +
      '    INDEX idx_month_year (month_year)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Insert default expense categories\n' +
      'INSERT INTO expense_categories (name, name_ar, description, color) VALUES\n' +
      "('Office Rent', 'Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨', 'Monthly office rental payments', '#e74c3c'),\n" +
      "('Marketing', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Advertising and promotional expenses', '#3498db'),\n" +
      "('Equipment', 'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', 'Computer equipment and tools', '#9b59b6'),\n" +
      "('Utilities', 'Ø§Ù„Ù…Ø±Ø§ÙÙ‚', 'Electricity, internet, phone bills', '#f39c12'),\n" +
      "('Transportation', 'Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª', 'Travel and delivery expenses', '#1abc9c'),\n" +
      "('Office Supplies', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨', 'Stationery and office materials', '#34495e'),\n" +
      "('Professional Services', 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', 'Legal, accounting, consulting fees', '#e67e22'),\n" +
      "('Maintenance', 'Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Equipment maintenance and repairs', '#95a5a6'),\n" +
      "('Insurance', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Business insurance premiums', '#2c3e50'),\n" +
      "('Miscellaneous', 'Ù…ØªÙ†ÙˆØ¹Ø©', 'Other business expenses', '#7f8c8d');\n" +
      'DELIMITER ;\n' +
      '\n' +
      '-- Add foreign key to link invoice items with product costs (optional enhancement)\n' +
      'ALTER TABLE invoice_items ADD COLUMN product_cost_id INT DEFAULT NULL;\n' +
      'ALTER TABLE invoice_items ADD FOREIGN KEY (product_cost_id) REFERENCES product_costs(id) ON DELETE SET NULL;\n' +
      '\n' +
      '-- Add calculated profit fields to invoice_items table\n' +
      'ALTER TABLE invoice_items ADD COLUMN cost_price DECIMAL(10,2) DEFAULT NULL;\n' +
      'ALTER TABLE invoice_items ADD COLUMN profit_amount DECIMAL(10,2) GENERATED ALWAYS AS (\n' +
      '    CASE \n' +
      '        WHEN cost_price IS NOT NULL THEN (amount - cost_price) * quantity\n' +
      '        ELSE NULL \n' +
      '    END\n' +
      ') STORED;\n' +
      'ALTER TABLE invoice_items ADD COLUMN profit_margin DECIMAL(5,2) GENERATED ALWAYS AS (\n' +
      '    CASE \n' +
      '        WHEN cost_price IS NOT NULL AND amount > 0 THEN ((amount - cost_price) / amount) * 100\n' +
      '        ELSE NULL \n' +
      '    END\n' +
      ') STORED;',
    parameters: undefined
  },
  original: Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'CREATE TABLE IF NOT EXISTS expenses (
      id INT AUTO_INCREMENT PRIMARY KEY,
     ' at line 17
      at Packet.asError (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/commands/command.js:29:26)
      at Connection.handlePacket (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:475:34)
      at PacketParser.onPacket (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/media/saif/brain/Laapak-Softwares/Laapak-Report-System/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_PARSE_ERROR',
    errno: 1064,
    sqlState: '42000',
    sqlMessage: "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'CREATE TABLE IF NOT EXISTS expenses (\n" +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      "   ' at line 17",
    sql: '-- Migration: Create Financial Management Tables\n' +
      '-- This migration adds tables for tracking product costs, expenses, and financial analytics\n' +
      '\n' +
      '-- Create expense categories table\n' +
      'CREATE TABLE IF NOT EXISTS expense_categories (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    name VARCHAR(100) NOT NULL,\n' +
      '    name_ar VARCHAR(100) NOT NULL,\n' +
      '    description TEXT,\n' +
      "    color VARCHAR(7) DEFAULT '#007553',\n" +
      '    budget_limit DECIMAL(10,2) DEFAULT NULL,\n' +
      '    is_active BOOLEAN DEFAULT TRUE,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create expenses table\n' +
      'CREATE TABLE IF NOT EXISTS expenses (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    name VARCHAR(255) NOT NULL,\n' +
      '    name_ar VARCHAR(255) NOT NULL,\n' +
      '    amount DECIMAL(10,2) NOT NULL,\n' +
      '    category_id INT NOT NULL,\n' +
      "    type ENUM('fixed', 'variable') NOT NULL DEFAULT 'variable',\n" +
      '    date DATE NOT NULL,\n' +
      '    repeat_monthly BOOLEAN DEFAULT FALSE,\n' +
      '    description TEXT,\n' +
      '    receipt_url VARCHAR(500),\n' +
      "    status ENUM('pending', 'approved', 'paid', 'cancelled') DEFAULT 'approved',\n" +
      '    created_by INT NOT NULL,\n' +
      '    approved_by INT DEFAULT NULL,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE RESTRICT,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (approved_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
      '    INDEX idx_date (date),\n' +
      '    INDEX idx_type (type),\n' +
      '    INDEX idx_status (status),\n' +
      '    INDEX idx_category (category_id)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create product costs table (to track cost prices)\n' +
      'CREATE TABLE IF NOT EXISTS product_costs (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    product_name VARCHAR(255) NOT NULL,\n' +
      '    product_model VARCHAR(255) NOT NULL,\n' +
      '    serial_number VARCHAR(255),\n' +
      '    cost_price DECIMAL(10,2) NOT NULL,\n' +
      '    supplier VARCHAR(255),\n' +
      '    purchase_date DATE,\n' +
      '    effective_date DATE NOT NULL,\n' +
      '    notes TEXT,\n' +
      '    created_by INT NOT NULL,\n' +
      '    updated_by INT,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (updated_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
      '    INDEX idx_product_name (product_name),\n' +
      '    INDEX idx_product_model (product_model),\n' +
      '    INDEX idx_serial_number (serial_number),\n' +
      '    INDEX idx_effective_date (effective_date)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create monthly financial summaries table (for faster dashboard queries)\n' +
      'CREATE TABLE IF NOT EXISTS financial_summaries (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
      '    total_revenue DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    total_cost DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    total_expenses DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    gross_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    net_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
      '    profit_margin DECIMAL(5,2) DEFAULT 0.00,\n' +
      '    invoice_count INT DEFAULT 0,\n' +
      '    expense_count INT DEFAULT 0,\n' +
      '    last_calculated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    UNIQUE KEY unique_month_year (month_year),\n' +
      '    INDEX idx_month_year (month_year)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Create budget allocations table\n' +
      'CREATE TABLE IF NOT EXISTS budget_allocations (\n' +
      '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
      '    category_id INT NOT NULL,\n' +
      '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
      '    allocated_amount DECIMAL(10,2) NOT NULL,\n' +
      '    spent_amount DECIMAL(10,2) DEFAULT 0.00,\n' +
      '    remaining_amount DECIMAL(10,2) GENERATED ALWAYS AS (allocated_amount - spent_amount) STORED,\n' +
      '    notes TEXT,\n' +
      '    created_by INT NOT NULL,\n' +
      '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
      '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
      '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE CASCADE,\n' +
      '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
      '    UNIQUE KEY unique_category_month (category_id, month_year),\n' +
      '    INDEX idx_month_year (month_year)\n' +
      ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
      '\n' +
      '-- Insert default expense categories\n' +
      'INSERT INTO expense_categories (name, name_ar, description, color) VALUES\n' +
      "('Office Rent', 'Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨', 'Monthly office rental payments', '#e74c3c'),\n" +
      "('Marketing', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Advertising and promotional expenses', '#3498db'),\n" +
      "('Equipment', 'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', 'Computer equipment and tools', '#9b59b6'),\n" +
      "('Utilities', 'Ø§Ù„Ù…Ø±Ø§ÙÙ‚', 'Electricity, internet, phone bills', '#f39c12'),\n" +
      "('Transportation', 'Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª', 'Travel and delivery expenses', '#1abc9c'),\n" +
      "('Office Supplies', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨', 'Stationery and office materials', '#34495e'),\n" +
      "('Professional Services', 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', 'Legal, accounting, consulting fees', '#e67e22'),\n" +
      "('Maintenance', 'Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Equipment maintenance and repairs', '#95a5a6'),\n" +
      "('Insurance', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Business insurance premiums', '#2c3e50'),\n" +
      "('Miscellaneous', 'Ù…ØªÙ†ÙˆØ¹Ø©', 'Other business expenses', '#7f8c8d');\n" +
      'DELIMITER ;\n' +
      '\n' +
      '-- Add foreign key to link invoice items with product costs (optional enhancement)\n' +
      'ALTER TABLE invoice_items ADD COLUMN product_cost_id INT DEFAULT NULL;\n' +
      'ALTER TABLE invoice_items ADD FOREIGN KEY (product_cost_id) REFERENCES product_costs(id) ON DELETE SET NULL;\n' +
      '\n' +
      '-- Add calculated profit fields to invoice_items table\n' +
      'ALTER TABLE invoice_items ADD COLUMN cost_price DECIMAL(10,2) DEFAULT NULL;\n' +
      'ALTER TABLE invoice_items ADD COLUMN profit_amount DECIMAL(10,2) GENERATED ALWAYS AS (\n' +
      '    CASE \n' +
      '        WHEN cost_price IS NOT NULL THEN (amount - cost_price) * quantity\n' +
      '        ELSE NULL \n' +
      '    END\n' +
      ') STORED;\n' +
      'ALTER TABLE invoice_items ADD COLUMN profit_margin DECIMAL(5,2) GENERATED ALWAYS AS (\n' +
      '    CASE \n' +
      '        WHEN cost_price IS NOT NULL AND amount > 0 THEN ((amount - cost_price) / amount) * 100\n' +
      '        ELSE NULL \n' +
      '    END\n' +
      ') STORED;',
    parameters: undefined
  },
  sql: '-- Migration: Create Financial Management Tables\n' +
    '-- This migration adds tables for tracking product costs, expenses, and financial analytics\n' +
    '\n' +
    '-- Create expense categories table\n' +
    'CREATE TABLE IF NOT EXISTS expense_categories (\n' +
    '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
    '    name VARCHAR(100) NOT NULL,\n' +
    '    name_ar VARCHAR(100) NOT NULL,\n' +
    '    description TEXT,\n' +
    "    color VARCHAR(7) DEFAULT '#007553',\n" +
    '    budget_limit DECIMAL(10,2) DEFAULT NULL,\n' +
    '    is_active BOOLEAN DEFAULT TRUE,\n' +
    '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
    '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n' +
    ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
    '\n' +
    '-- Create expenses table\n' +
    'CREATE TABLE IF NOT EXISTS expenses (\n' +
    '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
    '    name VARCHAR(255) NOT NULL,\n' +
    '    name_ar VARCHAR(255) NOT NULL,\n' +
    '    amount DECIMAL(10,2) NOT NULL,\n' +
    '    category_id INT NOT NULL,\n' +
    "    type ENUM('fixed', 'variable') NOT NULL DEFAULT 'variable',\n" +
    '    date DATE NOT NULL,\n' +
    '    repeat_monthly BOOLEAN DEFAULT FALSE,\n' +
    '    description TEXT,\n' +
    '    receipt_url VARCHAR(500),\n' +
    "    status ENUM('pending', 'approved', 'paid', 'cancelled') DEFAULT 'approved',\n" +
    '    created_by INT NOT NULL,\n' +
    '    approved_by INT DEFAULT NULL,\n' +
    '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
    '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
    '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE RESTRICT,\n' +
    '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
    '    FOREIGN KEY (approved_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
    '    INDEX idx_date (date),\n' +
    '    INDEX idx_type (type),\n' +
    '    INDEX idx_status (status),\n' +
    '    INDEX idx_category (category_id)\n' +
    ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
    '\n' +
    '-- Create product costs table (to track cost prices)\n' +
    'CREATE TABLE IF NOT EXISTS product_costs (\n' +
    '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
    '    product_name VARCHAR(255) NOT NULL,\n' +
    '    product_model VARCHAR(255) NOT NULL,\n' +
    '    serial_number VARCHAR(255),\n' +
    '    cost_price DECIMAL(10,2) NOT NULL,\n' +
    '    supplier VARCHAR(255),\n' +
    '    purchase_date DATE,\n' +
    '    effective_date DATE NOT NULL,\n' +
    '    notes TEXT,\n' +
    '    created_by INT NOT NULL,\n' +
    '    updated_by INT,\n' +
    '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
    '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
    '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
    '    FOREIGN KEY (updated_by) REFERENCES admins(id) ON DELETE SET NULL,\n' +
    '    INDEX idx_product_name (product_name),\n' +
    '    INDEX idx_product_model (product_model),\n' +
    '    INDEX idx_serial_number (serial_number),\n' +
    '    INDEX idx_effective_date (effective_date)\n' +
    ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
    '\n' +
    '-- Create monthly financial summaries table (for faster dashboard queries)\n' +
    'CREATE TABLE IF NOT EXISTS financial_summaries (\n' +
    '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
    '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
    '    total_revenue DECIMAL(12,2) DEFAULT 0.00,\n' +
    '    total_cost DECIMAL(12,2) DEFAULT 0.00,\n' +
    '    total_expenses DECIMAL(12,2) DEFAULT 0.00,\n' +
    '    gross_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
    '    net_profit DECIMAL(12,2) DEFAULT 0.00,\n' +
    '    profit_margin DECIMAL(5,2) DEFAULT 0.00,\n' +
    '    invoice_count INT DEFAULT 0,\n' +
    '    expense_count INT DEFAULT 0,\n' +
    '    last_calculated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
    '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
    '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
    '    UNIQUE KEY unique_month_year (month_year),\n' +
    '    INDEX idx_month_year (month_year)\n' +
    ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
    '\n' +
    '-- Create budget allocations table\n' +
    'CREATE TABLE IF NOT EXISTS budget_allocations (\n' +
    '    id INT AUTO_INCREMENT PRIMARY KEY,\n' +
    '    category_id INT NOT NULL,\n' +
    '    month_year VARCHAR(7) NOT NULL, -- Format: 2025-01\n' +
    '    allocated_amount DECIMAL(10,2) NOT NULL,\n' +
    '    spent_amount DECIMAL(10,2) DEFAULT 0.00,\n' +
    '    remaining_amount DECIMAL(10,2) GENERATED ALWAYS AS (allocated_amount - spent_amount) STORED,\n' +
    '    notes TEXT,\n' +
    '    created_by INT NOT NULL,\n' +
    '    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
    '    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n' +
    '    FOREIGN KEY (category_id) REFERENCES expense_categories(id) ON DELETE CASCADE,\n' +
    '    FOREIGN KEY (created_by) REFERENCES admins(id) ON DELETE CASCADE,\n' +
    '    UNIQUE KEY unique_category_month (category_id, month_year),\n' +
    '    INDEX idx_month_year (month_year)\n' +
    ') ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n' +
    '\n' +
    '-- Insert default expense categories\n' +
    'INSERT INTO expense_categories (name, name_ar, description, color) VALUES\n' +
    "('Office Rent', 'Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨', 'Monthly office rental payments', '#e74c3c'),\n" +
    "('Marketing', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Advertising and promotional expenses', '#3498db'),\n" +
    "('Equipment', 'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', 'Computer equipment and tools', '#9b59b6'),\n" +
    "('Utilities', 'Ø§Ù„Ù…Ø±Ø§ÙÙ‚', 'Electricity, internet, phone bills', '#f39c12'),\n" +
    "('Transportation', 'Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª', 'Travel and delivery expenses', '#1abc9c'),\n" +
    "('Office Supplies', 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨', 'Stationery and office materials', '#34495e'),\n" +
    "('Professional Services', 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©', 'Legal, accounting, consulting fees', '#e67e22'),\n" +
    "('Maintenance', 'Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Equipment maintenance and repairs', '#95a5a6'),\n" +
    "('Insurance', 'Ø§Ù„ØªØ£Ù…ÙŠÙ†', 'Business insurance premiums', '#2c3e50'),\n" +
    "('Miscellaneous', 'Ù…ØªÙ†ÙˆØ¹Ø©', 'Other business expenses', '#7f8c8d');\n" +
    'DELIMITER ;\n' +
    '\n' +
    '-- Add foreign key to link invoice items with product costs (optional enhancement)\n' +
    'ALTER TABLE invoice_items ADD COLUMN product_cost_id INT DEFAULT NULL;\n' +
    'ALTER TABLE invoice_items ADD FOREIGN KEY (product_cost_id) REFERENCES product_costs(id) ON DELETE SET NULL;\n' +
    '\n' +
    '-- Add calculated profit fields to invoice_items table\n' +
    'ALTER TABLE invoice_items ADD COLUMN cost_price DECIMAL(10,2) DEFAULT NULL;\n' +
    'ALTER TABLE invoice_items ADD COLUMN profit_amount DECIMAL(10,2) GENERATED ALWAYS AS (\n' +
    '    CASE \n' +
    '        WHEN cost_price IS NOT NULL THEN (amount - cost_price) * quantity\n' +
    '        ELSE NULL \n' +
    '    END\n' +
    ') STORED;\n' +
    'ALTER TABLE invoice_items ADD COLUMN profit_margin DECIMAL(5,2) GENERATED ALWAYS AS (\n' +
    '    CASE \n' +
    '        WHEN cost_price IS NOT NULL AND amount > 0 THEN ((amount - cost_price) / amount) * 100\n' +
    '        ELSE NULL \n' +
    '    END\n' +
    ') STORED;',
  parameters: {}
}
Migrations failed, falling back to automatic sync
Synchronizing database models...
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'admins' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `admins`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'clients' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `clients`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'reports' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `reports`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'money_locations' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `money_locations`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'invoices' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `invoices`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'product_costs' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `product_costs`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'invoice_items' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `invoice_items`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'report_technical_tests' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `report_technical_tests`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'invoice_reports' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `invoice_reports`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'goals' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `goals`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'achievements' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `achievements`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'expense_categories' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `expense_categories`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'expenses' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `expenses`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'financial_summaries' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `financial_summaries`
Executing (default): SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = 'money_movements' AND TABLE_SCHEMA = 'laapak_report_system'
Executing (default): SHOW INDEX FROM `money_movements`
Database synchronized successfully
Executing (default): SELECT count(*) AS `count` FROM `admins` AS `Admin`;
Executing (default): SELECT count(*) AS `count` FROM `clients` AS `Client`;
Ensuring all required tables exist...
Checking database connection...
Executing (default): SELECT 1+1 AS result
Database connection established successfully.
Executing (default): SELECT COUNT(*) as count 
            FROM information_schema.tables 
            WHERE table_schema = 'laapak_report_system' 
            AND table_name = 'reports'
Reports table already exists.
All required tables exist.
All required tables verified successfully.
Server running on port 3001
API available at http://localhost:3001/api
Serving index.html from: /media/saif/brain/Laapak-Softwares/Laapak-Report-System/frontend/public/pages/index.html
File exists: true
[0mGET / [32m200[0m 17.788 ms - 23457[0m
[0mGET /.well-known/appspecific/com.chrome.devtools.json [33m404[0m 11.945 ms - 187[0m
[0mGET /styles/base/styles.css [33m404[0m 8.683 ms - 161[0m
[0mGET /scripts/config.js [33m404[0m 3.315 ms - 156[0m
[0mGET /assets/images/logo.png [32m200[0m 14.632 ms - 104999[0m
[0mGET /scripts/auth-middleware.js [33m404[0m 2.266 ms - 165[0m
[0mGET /styles/base/styles.css [33m404[0m 1.928 ms - 161[0m
[0mGET /scripts/auth-check.js [33m404[0m 5.786 ms - 160[0m
[0mGET /scripts/main.js [33m404[0m 5.935 ms - 154[0m
[0mGET /scripts/login.js [33m404[0m 2.513 ms - 155[0m
[0mGET /service-worker.js [36m304[0m 4.076 ms - -[0m
[0mGET /manifest.json [36m304[0m 4.068 ms - -[0m
[0mGET /assets/images/cropped-Logo-mark.png.png [32m200[0m 10.046 ms - 14625[0m
Serving index.html from: /media/saif/brain/Laapak-Softwares/Laapak-Report-System/frontend/public/pages/index.html
File exists: true
[0mGET / [36m304[0m 8.126 ms - -[0m
[0mGET /index.html [33m404[0m 9.075 ms - 149[0m
[0mGET /report.html [33m404[0m 10.359 ms - 150[0m
[0mGET /admin.html [33m404[0m 1.976 ms - 149[0m
[0mGET /assets/images/cropped-Logo-mark.png.png [36m304[0m 3.713 ms - -[0m
[0mGET /img/cropped-Logo-mark.png.png [33m404[0m 4.570 ms - 168[0m
