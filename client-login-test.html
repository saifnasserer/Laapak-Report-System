<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار تسجيل دخول العميل | Laapak</title>
    
    <!-- Bootstrap RTL CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">اختبار تسجيل دخول العميل</h4>
                    </div>
                    <div class="card-body">
                        <div id="loginForm">
                            <div class="mb-3">
                                <label for="phone" class="form-label">رقم الهاتف</label>
                                <input type="text" class="form-control" id="phone" value="0501234567">
                            </div>
                            <div class="mb-3">
                                <label for="orderCode" class="form-label">كود الطلب</label>
                                <input type="text" class="form-control" id="orderCode" value="LP12345">
                            </div>
                            <button id="loginBtn" class="btn btn-primary w-100">تسجيل الدخول</button>
                        </div>
                        
                        <div class="mt-4">
                            <h5>نتيجة تسجيل الدخول:</h5>
                            <pre id="loginResult" class="bg-light p-3 mt-2" style="direction: ltr; text-align: left; max-height: 300px; overflow: auto;"></pre>
                        </div>
                        <div id="actionButtons" class="mt-3 d-none">
                            <a href="client-dashboard.html" class="btn btn-success btn-sm">Go to Dashboard</a>
                            <button class="btn btn-danger btn-sm ms-2" id="logoutBtn">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/laravel-api-service.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            const loginResult = document.getElementById('loginResult');
            const actionButtons = document.getElementById('actionButtons');
            
            // Check if already logged in as client
            if (apiService.isLoggedIn('client')) {
                const clientInfo = JSON.parse(localStorage.getItem('clientInfo') || sessionStorage.getItem('clientInfo'));
                loginResult.textContent = `Already logged in as: ${clientInfo.name} (${clientInfo.phone})`;
                actionButtons.classList.remove('d-none');
            }
            
            // Add logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function() {
                apiService.clearToken('client');
                loginResult.textContent = 'Logged out successfully';
                actionButtons.classList.add('d-none');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            });
            
            loginBtn.addEventListener('click', async function() {
                const phone = document.getElementById('phone').value;
                const orderCode = document.getElementById('orderCode').value;
                
                if (!phone || !orderCode) {
                    loginResult.textContent = 'Error: Please enter both phone and order code';
                    return;
                }
                
                loginResult.textContent = 'Logging in with Laravel backend...';
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جاري تسجيل الدخول...';
                
                try {
                    // Make the login request using the Laravel API service
                    const response = await apiService.clientLogin(phone, orderCode, false);
                    
                    // Display the response
                    loginResult.innerHTML = `<strong>Login Successful!</strong><br>
<pre>{
  "success": true,
  "client": {
    "id": ${response.client?.id || 0},
    "name": "${response.client?.name || 'Unknown'}",
    "phone": "${response.client?.phone || phone}"
  },
  "token": "${response.token ? response.token.substring(0, 20) + '...' : 'No token'}"
}</pre>`;
                    
                    // Show action buttons
                    actionButtons.classList.remove('d-none');
                } catch (error) {
                    loginResult.textContent = `Error: ${error.message}`;
                    actionButtons.classList.add('d-none');
                } finally {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'تسجيل الدخول';
                }
            });
        });
    </script>
</body>
</html>
